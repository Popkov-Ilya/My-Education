# NMAP

#### **|	База**

```bash
# as root - Syn scan | as user - TCP connect scan
nmap 192.168.1.35 # самое простое сканирование 1000 портов

sort -r -k3 /usr/share/nmap/nmap-services | grep tcp | head -n 100 # посмотреть наиболее популярные порты
```



#### **|	Параметры**

```bash
nmap -iL target.file # из файла
nmap -iR 3 -vv # 3 рандомных ip с большей вербальностью
# если нажать v в процессе сканирования - вербальность повысится
```



#### **|	HOST DISCOVERY**

Базовая проверка на активность без опций host-discovery

* ICMP edho request (ping)
* TCP SYN to 443
* TCP ACK to 80
* ICMP timestamp request
* ARP

```bash
nmap 192.168.1.1-5 -v # базовая проверка на активность и только потом проверка на открытые порты
```

1) Составление списка с помощью обратного DNS поиска

```bash
nmap -iR 300 -sL -vv # искатель приключений
```

2) Ping сканирование - базовая проверка, но без сканирования портов

```bash
nmap 192.168.1.1/24 -sn
```

3) Обратное - пропустить проверку на активность и выполнить сканирование

```bash
nmap 192.168.1.1/24 -Pn -v
```

4) Обнаружение по определенным портам или протоколам

```bash
nmap -iR 10 -PS22-25,80.113 -sn # PS/PA/PU/PY - Syn/Ack/Udp/SCTP
nmap -iR 10 -PE -sn # PE/PP/PM - ICMP echo/timestamp/netmask
nmap -iR 10 -PO1,2,4  -sn # IP проверка 1 = ICMP 2 = IGMP 3 = IPvIP
nmap -iR 10 -PR -sn # ARP проверка - самый быстрый
```

5) Доп приколы

* *-n/-R никогда не производить DNS разрешение / всегда проводить его*
* *--dns-server 192.168.1.4 проводить разрешение по определенным серверам (полезно в комбе с -sL)*
* *--system-dns - использовать системный резолв*
* *--traceroute - и так понятно*



6) БОНУС!!!

```bash
nmap 192.168.1.1/24 -sn | grep -wv "host down" > hosts.txt # активные хосты (проверка любая)
cat hosts.txt | grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}" > clear_hosts.txt # чистые адреса
```



#### **|	Приемы сканирования**



1. База

| Парметр | Суть                                       |
| ------- | ------------------------------------------ |
| -sS     | TCP SYN                                    |
| -sT     | TCP Connect                                |
| -sA     | TCP ACK (применяется для анализа Firewall) |
| -sW     | Window (тоже)                              |
| -sM     | Maimon (FIN-ACK)                           |



2) Дополнительные

| Параметр               | Суть                                          |
| ---------------------- | --------------------------------------------- |
| -sU                    | UDP сканирование                              |
| -sN                    | TCP Null сканирование                         |
| -sF                    | TCP FIN сканирование                          |
| -sX                    | Xmas сканирование (FIN + Pish + Urgent флаги) |
| --scan-flags \<flags\> | Если хочешь проставить свои флаги             |
| -sY                    | SCTP сканирование                             |
| -sZ                    | Coockie echo сканирование                     |
| -sV                    | Определение версий служб                      |
| --host-timeout 2m      | Для UDP можно порезать время ожидания ответа  |



3) Прикольные

| Параметр                   | Суть                                                         |
| -------------------------- | ------------------------------------------------------------ |
| -sI \<zombie-host:port\>   | Зомби-сканирование (Idle-scan)                               |
| -sO -p \<номер протокола\> | Сканирование по определенным ip протоколам (см ниже) = их номер можешь глянуть в wireshark *(PS - не путай с -p = port)* |
| -b \<host\>                | FTP bounce сканирование                                      |

```bash
nmap 192.168.1.89 -sO -p 1,2,3,4,5,6,17
# 1 = icmp
# 2 = igmp
# 3 = ggp
# 4 = ipv4
# 5 = st
# 6 = tcp
# 17 = udp
```

