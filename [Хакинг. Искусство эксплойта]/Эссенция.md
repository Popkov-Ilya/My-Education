# Хакинг. Искусство эксплойта (Джон Эриксон)

Книга читается – хакинг изучается



## Начало

Начнем с малого

```bash
gcc firstprog.c #скомпилировать c код в исполняемый файл a.out
ls -lh a.out
./a.out
```



Расширяем горизонты

```bash
#посмотреть дизассемблированный код a.out
objdump -D a.out | grep -A20 main.:

#посмотреть дизассемблированный код a.out в синтаксисе интел
objdump -M intel -D a.out | grep -A20 main.:
```



Работаем с отладчиком

```bash
gdb -q a.out
#дальше все что начинается с (gdb) происходит внутри отладчика
(gdb) break main #поставить точку останова
(gdb) run #запустить прогу
(gdb) info registers #посмотреть состояние регистров до запуска мейна
(gdb) quit #выйти из отладчика
```



И вот они регистры x86 слева направо

| Название                       | Суть                                                         |
| :----------------------------- | ------------------------------------------------------------ |
| **Временные переменные**       | *=====================================================================* |
| **eax**                        | аккумулятор                                                  |
| **ecx**                        | счетчик                                                      |
| **edx**                        | данных                                                       |
| **ebx**                        | база                                                         |
| **Регистры общего назначения** | *=====================================================================* |
| **esp**                        | указатель стека                                              |
| **ebp**                        | указатель базы                                               |
| **esi**                        | индекс источника                                             |
| **edi**                        | индекс приемника                                             |
| **Особые**                     | *=====================================================================* |
| **eip**                        | указатель инструкции                                         |
| **eflags** (pf sf if)          | флаги для сравнений и адресации                              |



Настраиваем отладчик под Интел архитектуру

```bash
gdb -q
(gbd) set disassembly intel
(gdb) quit

echo "set dis intel" > ~/.gdbinit #1) команды gdb можно сокращать 2) настройки нужно сохранить для перезапусков
```



Еще синтаксис компилятора и отладчика

```bash
gcc -g firstprog.c #добавляет в программу данные о коде
gdb -q a.out
(gdb) list #выведет c-код программы
(gdb) disassemble main #вывести дизассемблированный мейн
(gdb) break main #поставить как обычно точку останова
(gdb) run #запустить прогу (теперь отладчик знает на какой строке c-кода он остановился)
(gdb) info register eip #посмотреть что находится в регистре указателя инструкции
```



## Базовые команды

Первый вариант оформления

```assembly
mov ebp, esp #перемещает из esp в ebp
sub esp, 0x8 #вычитает из esp 8 и записывает результат в esp

cmp DWORD PTR [ebp-4], 0x9 #cmp сравнивает, DWORD - четыре байта
jle 8048393 <main+0x1f> #jump if less or equal to
jmp 80483a6 <main+0x32> #безусловный jump
```



Второй вариант оформления

| Команда                      | Смысл                                          |
| ---------------------------- | ---------------------------------------------- |
| `mov ebp, esp`               | перемещает из esp в ebp                        |
| `sub esp, 0x8`               | вычитает из esp 8 и записывает результат в esp |
| `cmp DWORD PTR [ebp-4], 0x9` | cmp сравнивает, DWORD - четыре байта           |
| `jle 8048393 <main+0x1f>`    | jump if less or equal to                       |
| `jmp 80483a6 <main+0x32>`    | безусловный jump                               |

